<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metamerism</title>
    <link rel="stylesheet" href="./assets/style/style.css">

</head>
<body>
    <div class="title">
        <h1>metamerism</h1>
    </div>
    <div class="des">
        <p>a thousand images, a thousand hues, to explore. <br></p>
    </div>
    <div class="info">
        <p> lara bernasconi <br>
            supsi - mendrisio <br>
        </p>
        <p>
            elaborato xl <br>
            interaction design <br>
                </p>
                <p>
                    <a class="corso" href="https://ixd-supsi.github.io/2024/">
                428.01</a> <br>
        Andreas Gysin <br>
        Giovanni Profeta <br>
    </p>
</div>
    <div class="categories">
        <span class="category" data-hue="0-30">orange</span>
        <span class="category" data-hue="30-90">yellow</span>
        <span class="category" data-hue="90-150">green</span>
        <span class="category" data-hue="150-210">cyan</span>
        <span class="category" data-hue="210-270">blue</span>
        <span class="category" data-hue="270-330">magenta</span>
        <span class="category" data-hue="330-360">red</span>
    </div>
    <main></main>
    <div class="tooltip" id="tooltip"></div>
    <script>
        function HexToHSL(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (!result) {
                throw new Error("Could not parse Hex Color");
            }

            const rHex = parseInt(result[1], 16);
            const gHex = parseInt(result[2], 16);
            const bHex = parseInt(result[3], 16);

            const r = rHex / 255;
            const g = gHex / 255;
            const b = bHex / 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);

            let h = (max + min) / 2;
            let s = h;
            let l = h;

            if (max === min) {
                // Achromatic
                return { h: 0, s: 0, l };
            }

            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r:
                    h = (g - b) / d + (g < b ? 6 : 0);
                    break;
                case g:
                    h = (b - r) / d + 2;
                    break;
                case b:
                    h = (r - g) / d + 4;
                    break;
            }
            h /= 6;

            s = s * 100;
            s = Math.round(s);
            l = l * 100;
            l = Math.round(l);
            h = Math.round(360 * h);

            return { h, s, l };
        }

        let exifData = [];
        let colorDict = {};

        async function fetchData() {
            exifData = await fetch("./assets/data/data_exif.json").then(r => r.json());
            const colorData = await fetch("./assets/data/data_colors.json").then(r => r.json());

            colorData.forEach(color => {
                colorDict[color.FileName] = color.Colors.map(hex => HexToHSL(hex));
            });
        }

        function displayFilteredData(filteredData) {
            let output = "";
            for (let i = 0; i < filteredData.length; i++) {
                const fileName = filteredData[i].FileName;
                const HSL = colorDict[fileName][0];

                output += `
                    <div class="image-info" onmouseover="showTooltip(event, '${fileName}', ${HSL.h}, ${HSL.s}, ${HSL.l})" onmouseout="hideTooltip()">
                        <span class="color-box" style="background-color: hsl(${HSL.h}, ${HSL.s}%, ${HSL.l}%);"></span>
                    </div>
                `;
            }
            document.querySelector('main').innerHTML = output;
        }

        function filterByHueRange(hueRange) {
            const [minHue, maxHue] = hueRange.split('-').map(Number);
            const filteredData = exifData.filter(item => {
                const HSL = colorDict[item.FileName][0];
                return HSL.h >= minHue && HSL.h <= maxHue;
            });

            displayFilteredData(filteredData);
        }

        function showTooltip(event, fileName, h, s, l) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `hue: ${h}<br>saturation: ${s}%<br>lightness: ${l}%`;
            tooltip.style.display = 'block';
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY + 10}px`;
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        }

        async function run() {
            await fetchData();
            document.querySelectorAll('.category').forEach(category => {
                category.addEventListener('click', (e) => filterByHueRange(e.target.getAttribute('data-hue')));
            });
            displayFilteredData(exifData); // Display all data by default
        }

        run();
    </script>
</body>
</html>
